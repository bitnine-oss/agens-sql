<chapter id="powa">
 <title><productname>PoWA</productname></title>
 <para>
     <productname>PoWA</productname>는 <productname>PostgreSQL</productname>의 성능 통계 정보를 모아 실시간으로 차트와 그래프 형태를 이용하여 보여준다. 이로써 DB 관리자는 <productname>PoWA</productname>를 이용한 효율적인 모니터링과 손쉬운 튜닝을 할 수 있다. 
     <productname>PoWA</productname>에 대한 자세한 정보는 <ulink url="http://powa.readthedocs.org/en/latest"> http://powa.readthedocs.org/en/latest/</ulink>에서 확인하기 바란다.
 </para>
 <para>기본적으로 <productname>PoWA</productname>가 제공해주는 정보는 DB들에 대한 상세정보(평균구동시간, 블록 정보, I/O 시간),  DB시스템 전체의 질의 처리 수행시간, 각 DB에서 수행된 질의들과 해당 질의에 대한 성능 통계 정보 및 인덱스 추천 정보 등이 있다. 
이와 같은 DB 통계 정보들은 <productname>PostgreSQL</productname>의 stats collector 역할을 하는 모듈들이 모은 정보를 <productname>PoWA-archivist</productname>가 선별하여 종합하고 이를 <productname>PoWA-Web</productname>을 통해 사용자에게 보여 지게 된다. 아래는 이러한 사항을 반영한 PoWA의 개괄적인 아키텍쳐이다.</para>
 <screenshot>
     <screeninfo>PoWA architecture</screeninfo>
     <graphic fileref="images/powa_architecture.png">
 </screenshot>
 <para>PoWA는 브라우져를 통한 GUI 환경을 제공해주기 때문에 브라우져를 구동시킬 수 있는 모든 기기에서 DB 모니터링을 가능케 한다. 다음은 PoWA를 구동시킨 모습이다.    
 </para>
 <screenshot>
 <screeninfo>PoWA를 pc와 모바일에서 구동 시킨 모습</screeninfo>
     <graphic fileref="images/powa_screenshot.png">
 </screenshot>
 <sect1 id="powa-configuration">
     <title>설정</title>
     <para>
         <productname>PoWA</productname>는 <productname>PoWA-archivist</productname>와 <productname>PoWA-web</productname>의 두 가지 요소로 이루어져 있다. 이중에 <productname>PoWA-archivist</productname>는 <productname>pg_stat_statement</productname>와 <productname>pg_qualstats</productname>, <productname>pg_stat_kcache</productname> 모듈들의 집합으로 이루어져 있다. 이 중 <productname>pg_stat_statement</productname>는 가장 기본적인 통계정보를 제공해주는 <productname>PostgreSQL</productname> 내장 모듈로써 <productname>PoWA</productname> 구동시 자동으로 load 되지만 <productname>pg_qualstats</productname>와 <productname>pg_stat_kcache</productname>는 <productname>PoWA</productname>에 선택적으로 설치 및 적용이 가능하다. <productname>Agens SQL</productname>에서는 <productname>PoWA-archivist</productname> 인스톨시 <productname>pg_stat_statement</productname>, <productname>pg_qualstats</productname>, <productname>pg_stat_kcache</productname> 모두 설치 및 적용하여 줌으로 <productname>PoWA-archivist</productname>에 대한 별도의 설정 작업은 필요없다. 본 장에서는 PoWA-web을 별도로 설치할 시에 대한 설정에 대하여 알아본다.
     </para>
     <itemizedlist>
         <listitem>
             <para>
                 <productname>PoWA-web</productname>
             </para>
             <orderedlist>
                <listitem>
                    <para><productname>pip</productname>설치하기</para>
                    <para><productname>PoWA-web</productname>은 <productname>PoWA-archivist</productname>가 모은 통계정보를 web browser 환경으로 시각화하여 보여준다. <productname>PoWA-web</productname>의 설정에 앞서 파이썬 관련 패키지 설치 프로그램인 <productname>pip</productname>를 먼저 설치하기 바란다. (<productname>PoWA-web</productname>을 이용한 UI는 <productname>Perl</productname> 기반, <productname>Apache</productname>를 이용한 CGI기반, <productname>Nginx</productname>기반 등 다양한 형태로 제공될 수 있다.)</para>
                    <para>
                        <command>$ yum install python-pip python-psycopg2                # RHEL, centos 기준</command>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <productname>PoWA-web</productname>설치하기
                    </para>
                    <para>
                        pip가 설치되면 이를 이용하여서 PoWA-web을 설치한다.
                    </para>
                    <para>
                        <command>$ pip install powa-web</command>
                    </para>
                </listitem>
                <listitem>
                    <para><productname>PoWA-web</productname> 기본 환경 설정하기</para>
                    <para>
                        <productname>PoWA-web</productname>이 설치되면 <filename>powa-web.conf</filename> 파일을 생성한다. (<filename>/etc/powa-web.conf</filename>, <filename>~/.config/powa-web.conf</filename>, <filename>~/.powa-web.conf</filename>, <filename>./powa-web.conf</filename> 중 하나에 생성하면 된다.)
                        <filename>powa-web.conf</filename> 파일 내부에 실무 환경에 맞는 환경 설정을 하여 설치를 마무리 한다. 환경 설정은 <filename>JSON</filename> 문법에 맞게 작성하면 된다. 다음은 그 예를 나타낸다.
                    </para>
                    <para>
                        <command>$ vi powa-web.conf</command>
                        <programlisting>
servers={
    ‘main’ : {
    ‘host’ : ‘localhost’,
    ‘port’ : ‘5432’,
    ‘database’ : ‘powa’
    }
}
cookie_secret=“SUPERSECRET_THAT_YOU_SHOUD_CHANGE"
                        </programlisting>
                    </para>
                    <para>
                    이 때 <command>cookie_secret</command>의 값은 클라이언트 브라우저에서 사용하는 쿠키정보를 암호화하여 서버와 통신하기 위한 키로 사용된다. 안전한 DB운영 환경을 위해 알맞은 값을 반드시 설정하기 바란다.
                    </para>
                    <warning>
                    <para>
                    <filename>powa-web.conf</filename> 설정시 <filename>pg_hba.conf</filename>의 내용에 맞는 설정이 필요하다. <filename>pg_hba.conf</filename> 설정에 대해서는 공식 <productname>PostgreSQL</productname> 문서를 참고하기 바란다.
                    </para>
                    </warning>
                </listitem>
             </orderedlist>
         </listitem>
     </itemizedlist>
 </sect1>
 <sect1 id="powa-quickstart">
     <title>Quick Start</title>
     <orderedlist>
         <listitem>
             <para>PoWA-web 프로세스 구동하기</para>
             <para><productname>PoWA-web</productname>을 이용하여 브라우져의 GUI 환경에서 DB를 관리하기 위해선 우선 서버측의 PoWA-web 프로세스를 구동하여야 한다.</para>
             <para>
                 <command>$ powa-web</command>
             </para>
         </listitem>
         <listitem>
             <para>브라우져를 통한 연결</para>
             <para>클라이언트측의 브라우저에서 powa-web.conf에서 설정한 정보를 이용하여 PoWA에 접속한다. 이 때 PoWA-web의 기본 포트는 8888 이다.</para>
             <para>접속 URL 포트를 변경하고 싶다면 python의 site-packages의 powa 폴더에서 options.py를 수정한다. 예를 들어, 포트번호를 7777로 변경하고자 한다면 아래와 같이 수정한다.</para>
             <para>
                 <command>$ vi options.py</command>
                 <programlisting>
...
    define(“port”, type=int, default=7777, metavar=“port”, help=“Listen on &lt;port&gt;”)
...
                 </programlisting>
             </para>
         </listitem>
     </orderedlist>
</sect1>
</chapter>