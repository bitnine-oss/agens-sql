<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>디스크 사용량 결정</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="Agens SQL 1.0 문서"
HREF="index.html"><LINK
REL="UP"
TITLE="디스크 사용량 모니터링"
HREF="diskusage.html"><LINK
REL="PREVIOUS"
TITLE="디스크 사용량 모니터링"
HREF="diskusage.html"><LINK
REL="NEXT"
TITLE="디스크 꽉 참(Full) 실패"
HREF="disk-full.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=UTF-8"><META
name="viewport"
content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width"><META
NAME="creation"
CONTENT="2015-06-29T09:12:38"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>Agens SQL 1.0 문서</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="디스크 사용량 모니터링"
HREF="diskusage.html"
ACCESSKEY="P"
>이전</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="diskusage.html"
ACCESSKEY="U"
>위로</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>장 12. 디스크 사용량 모니터링</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="디스크 꽉 참(Full) 실패"
HREF="disk-full.html"
ACCESSKEY="N"
>다음</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DISK-USAGE"
>12.1. 디스크 사용량 결정</A
></H1
><P
>   각 테이블은 대부분의 데이터가 저장되는 1차 힙 디스크 파일을 갖고 있다. 
   테이블 칼럼의 값이 잠재적으로 큰 범위인 경우 메인 테이블에 잘 맞지 않는 값을 저장하는 데 사용되고 테이블에 연결된 <ACRONYM
CLASS="ACRONYM"
>TOAST</ACRONYM
> 파일이 있을 수도 있다. 
   그런 경우에는, 유효 인덱스 1개가 <ACRONYM
CLASS="ACRONYM"
>TOAST</ACRONYM
> 테이블에 존재한다. 또한 베이스 테이블에 연결된 인덱스도 있을 수 있다. 각 테이블 및 인덱스는 개별 디스크 파일에 저장된다. 
   파일 크기가 1기가바이트를 초과하는 경우에는 파일이 하나 이상일 수 있다. 
  </P
><P
>   디스크 공간은 3가지 방법으로 모니터링할 수 있는데, 
   SQL 함수를 사용하거나, oid2name 모듈을 사용하거나, 시스템 카탈로그 수동 검사를 사용할 수 있다. 
   SQL 함수는 사용법이 매우 쉬워 보편적으로 권장된다. 
   이 절의 나머지 부분에서는 시스템 카탈로그를 검사하는 방법에 대해 설명한다.
  </P
><P
>   최근 vacuum되었거나 분석된 데이터베이스에서 <SPAN
CLASS="APPLICATION"
>psql</SPAN
>을 사용하면 쿼리를 실행하여 임의의 테이블에서 디스크 사용량을 볼 수 있다.
</P><PRE
CLASS="PROGRAMLISTING"
>SELECT pg_relation_filepath(oid), relpages FROM pg_class WHERE relname = 'customer';

 pg_relation_filepath | relpages
----------------------+----------
 base/16384/16806     |       60
(1 row)</PRE
><P>
   각 페이지는 일반적으로 8킬로바이트이다. (<TT
CLASS="STRUCTFIELD"
>relpages</TT
>는 <TT
CLASS="COMMAND"
>VACUUM</TT
> 및 <TT
CLASS="COMMAND"
>ANALYZE</TT
>, <TT
CLASS="COMMAND"
>CREATE INDEX</TT
> 같은 몇 가지 DDL 명령으로만 업데이트된다.) 
   파일 경로명은 테이블의 디스크 파일을 직접 검사하려는 경우에 중요하다.
  </P
><P
>   <ACRONYM
CLASS="ACRONYM"
>TOAST</ACRONYM
> 테이블에서 사용하는 공간을 표시하려면 다음과 같은 쿼리를 사용한다.
</P><PRE
CLASS="PROGRAMLISTING"
>SELECT relname, relpages
FROM pg_class,
     (SELECT reltoastrelid
      FROM pg_class
      WHERE relname = 'customer') AS ss
WHERE oid = ss.reltoastrelid OR
      oid = (SELECT indexrelid
             FROM pg_index
             WHERE indrelid = ss.reltoastrelid)
ORDER BY relname;

       relname        | relpages
----------------------+----------
 pg_toast_16806       |        0
 pg_toast_16806_index |        1</PRE
><P>
  </P
><P
>   인덱스 크기를 손쉽게 표시할 수도 있다.
</P><PRE
CLASS="PROGRAMLISTING"
>SELECT c2.relname, c2.relpages
FROM pg_class c, pg_class c2, pg_index i
WHERE c.relname = 'customer' AND
      c.oid = i.indrelid AND
      c2.oid = i.indexrelid
ORDER BY c2.relname;

       relname        | relpages
----------------------+----------
 customer_id_indexdex |       26</PRE
><P>
  </P
><P
>   이 정보를 이용하면 최대 크기의 테이블과 인덱스를 찾을 때 용이하다.
</P><PRE
CLASS="PROGRAMLISTING"
>SELECT relname, relpages
FROM pg_class
ORDER BY relpages DESC;

       relname        | relpages
----------------------+----------
 bigtable             |     3290
 customer             |     3144</PRE
><P>
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="diskusage.html"
ACCESSKEY="P"
>이전</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>처음으로</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="disk-full.html"
ACCESSKEY="N"
>다음</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>디스크 사용량 모니터링</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="diskusage.html"
ACCESSKEY="U"
>위로</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>디스크 꽉 참(Full) 실패</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>