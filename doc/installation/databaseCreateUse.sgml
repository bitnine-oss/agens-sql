<chapter id="databaseCreateUse">
 <title>데이터베이스 생성 및 사용</title>

   <para>
    데이터베이스 서버를 사용할 수 있는지를 확인하기 위한 테스트로 먼저 하나의 데이터베이스를 만들어 보겠다. 각각의 사용자 단위나, 프로젝트 단위로 데이터베이스를 분리해서 작업하는 것이 일반적이기에, 하나의 <productname>PostgreSQL</productname> 서버는 많은 데이터베이스를 관리할 수 있다.
   </para>

   <para>
    어쩌면, 이미 시스템 관리자가 일반 사용자들을 위해서 그들이 사용할 수 있는 데이터베이스를 미리 만들어 두었을 수도 있다. 이런 경우라면, 시스템 관리자로부터 데이터베이스 이름을 알아야 한다. 이렇게 이미 만들어진 데이터베이스가 있고, 그것의 이름이 어떤 것인지 알고 있다면, 이 섹션을 읽지 않아도 된다.
   </para>

   <para>
    예를 들어 <literal>mydb</literal>라는 이름의 새로운 데이터베이스를 생성하고자 한다면, 다음과 같은 명령을 사용한다:
<screen>
<prompt>$ </prompt><userinput>createdb mydb</userinput>
</screen>
   정상적으로 데이터베이스가 생성되면 다음과 같은 결과가 출력된다:
<screen><computeroutput>
CREATE DATABASE
</computeroutput></screen>
직접 해본 결과가 위의 메시지와 같다면, 그냥 이 섹션을 넘어가도 된다.
   </para>

   <para>
<screen><computeroutput>
createdb: command not found
</computeroutput></screen>
    이런 메시지가 나타났다면, <productname>PostgreSQL</> 패키지가 정상적으로 설치 되지 않았거나 사용자의 PATH 환경 변수에 <productname>PostgreSQL</> 설치 경로가 포함되어있지 않은 것이다. 이것을 확인해 보기 위해서는 절대 경로로 명령어를 호출하면 된다:
<screen>
<prompt>$ </prompt><userinput>/path/to/pgsql/bin/createdb mydb</userinput>
</screen>
    윗 명령에서의 절대 경로는 각 시스템마다 틀릴 수 있다. 정확히 알기 위해서는 시스템 관리자에게 확인하거나, 직접 설치했다면, 설치 과정을 다시 살펴보아야 한다.
   </para>

   <para>
    이 명령의 또 다른 결과로 다음과 같은 메시지가 보일 수 있다:
<screen><computeroutput>
createdb: could not connect to database template1: could not connect to server: 그런 파일이나 디렉터리가 없습니다
        Is the server running locally and accepting
        connections on Unix domain socket "/tmp/.s.
        PGSQL.5456"?
</computeroutput></screen>
    이 경우는 현재 시스템에는 PostgreSQL 서버가 가동 중이지 않다는 것을 의미한다.
    <filename>postgres</filename> 프로세스가 실행 중인지 확인하고, 서버가 가동 중이지 않다면 서버를 실행시켜 주어야 한다.
   </para>

   <para>
    또 다른 오류 메시지로,
<screen><computeroutput>
createdb: could not connect to database template1: FATAL:  role "kisu" does not exist
</computeroutput></screen>
    이 경우는 OS User의 이름이 데이터베이스 사용자로 등록되어있지 않은 경우이다. (<productname>PostgreSQL</productname> 에서는 데이터베이스 사용자로 특별히 지정하지 않았을 경우, 기본값으로 OS User의 이름을 사용한다.)  기본적으로 <productname>Agens SQL</productname>을 통해 설치된 <productname>PostgreSQL</productname>은 OS User의 이름을  <literal>agens</literal>로 사용할 것을 권장하며, 또한 데이터베이스 시스템 관리자는 <literal>agens</literal>로 생성된다. 또한 <productname>PostgreSQL</productname> 사용자와 시스템 사용자 이름 서로 틀릴 경우, -U 옵션을 사용해서 데이터베이스 사용자 이름을 지정하거나, <literal>PGUSER</literal> 시스템 환경변수로 그 이름을 지정해서 사용할 수 있다. 그러므로 OS User가 <literal>agens</literal>가 아닌경우 다음과 같은 명령으로 새로운 데이터베이스를 생성할 수 있다.
    <screen><command><prompt>$</prompt> createdb -U agens mydb</command></screen>
   </para>

   <para>
     <productname>PostgreSQL</productname>에서는 만들 수 있는 데이터베이스 개수 제한이 없다. 하지만, 데이터베이스 이름은 첫 글자가 영문 알파벳이어야 하고 길이는 최대 63 바이트까지 가능하다.

   </para>

   <para>
    생성된 데이터베이스가 더 이상 쓰일 일이 없으면, 데이터베이스를 삭제 할 수 있다. 예를 들어 <literal>mydb</literal> 데이터베이스를 만든 사람이 그 데이터베이스를 삭제하려면, 다음과 같은 명령을 사용하여 데이터베이스를 삭제할 수 있다:
<screen>
<prompt>$ </prompt><userinput>dropdb mydb</userinput>
</screen>
    <command>dropdb</command> 명령은 반드시 삭제할 데이터베이스 이름을 지정해 주어야 한다. 이 작업은 해당 데이터베이스와 관련된 모든 파일들을 물리적으로 완전히 삭제하는 것으로, 실행 취소를 할 수 없습니다. 따라서 <command>dropdb</command> 명령은 신중하게 사용해야 한다.
   </para>




 <para>
하나의 데이터베이스를 만들었다면, 이제 그 데이터베이스를 다음과 같은 방법으로 사용할 수 있다:


    <itemizedlist spacing="compact" mark="bullet">
     <listitem>
      <para>
       psql 이라는 PostgreSQL 대화형 터미널 프로그램을 실행하기. 이것은 대화형으로 SQL 명령을 편집/실행 할 수 있다.
      </para>
     </listitem>

     <listitem>
      <para>
       Agens Manager와 같은 그래픽 툴을 이용하거나 ODBC나 JDBC를 이용한 다른 툴들을 사용하여 데이터베이스를 만들거나 사용할 수 있다.
      </para>
     </listitem>

<listitem>
      <para>
       PostgreSQL에서 지원하는 프로그래밍 언어들을 이용하여 직접 응용 프로그램을 만들어서 사용할 수 있다.
      </para>
     </listitem>

    </itemizedlist>
여기서는 psql 프로그램을 이용해서 데이터베이스를 다루는 방법만을 다룬다. 먼저 앞에서 이야기한 mydb 데이터베이스를 성공적으로 만들었다면, 다음과 같이 입력하여 실행한다:
     </para>

<para>
<screen>
<prompt>$ </prompt><userinput>psql mydb</userinput>
</screen>
</para>
<para>
데이터베이스 이름을 입력하지 않으면 기본적으로 현재 시스템 사용자 이름과 동일한 이름의 데이터베이스에 접속을 시도한다.
윗 명령이 정상적으로 실행되면 다음과 같은 메시지를 볼 수 있습니다:
<screen><computeroutput>
psql (9.4.2)
Type "help" for help.</computeroutput>

<prompt>mydb=# </prompt>
</screen>
한편 맨 마지막 줄이 다음과 같을 수도 있다:
<screen>
<prompt>mydb=> </prompt>
</screen>
 '=#'의 경우는 현재 데이터베이스 사용자가 데이터베이스 관리자임을 나타내고 '=>'는 일반 사용자임을 나타낸다.
</para>
<para>
 만약 오류가 발생한다면, psql 프로그램의 실행이 createdb 프로그램의 실행 요건이 비슷하기 때문에 오류에 대한 대처 방안을 찾을 수 있다.
</para>
<para>
psql 프로그램을 실행했을 때 맨 마지막 줄에 나오는 프롬프트는 이제부터 SQL 쿼리를 사용할 수 있음을 의미한다. 다음과 같은 명령들을 통해 데이터베이스가 정상적으로 생성되고 실행되는지 확인해 볼 수 있다:
<screen>
<prompt>mydb=# </prompt><userinput>SELECT version();</userinput>
<computeroutput>                                                   version
--------------------------------------------------------------------------------------------------------------
 PostgreSQL 9.4.2 on x86_64-unknown-linux-gnu, compiled by gcc (GCC) 4.8.3 20140911 (Red Hat 4.8.3-9), 64-bit
(1 row)</computeroutput>

<prompt>mydb=# </prompt><userinput>SELECT current_date;</userinput>
<computeroutput>    date
------------
 2015-06-04
(1 row)</computeroutput>

<prompt>mydb=# </prompt><userinput>SELECT 2 + 2;</userinput>
<computeroutput> ?column?
----------
        4
(1 row)</computeroutput>
</screen>
</para>
<para>
psql 프로그램에서는 SQL 명령 말고도 내부적으로 사용할 수 있는 몇 가지 명령들이 있다. (psql 내장 명령이라고 한다.) 이 명령들은 역슬래쉬 ("\") 문자로 시작한다. 예를 들어, PostgreSQL SQL 구문을 살펴보려면 다음과 같이 입력하면 된다:
<screen>
<prompt>mydb=# </prompt><userinput>\h</userinput>
</screen>
psql을 마치려면 다음 명령을 입력한다:
<screen>
<prompt>mydb=# </prompt><userinput>\q</userinput>
</screen>
이 명령이 실행되면, psql 프로그램은 종료되고 다시 시스템 쉘 명령 프롬프트가 나타난다. (\? 명령을 이용하여 psql 내장 명령들을 모두 살펴볼 수 있다.)
</para>
</chapter>